<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
			PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
			"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="post">

	<insert id="insertPost" parameterClass="kr.or.ddit.post.vo.PostVO">
		<selectKey keyProperty="postNo" resultClass="String">
			SELECT LPAD(POST_SEQ.NEXTVAL,3,0) FROM DUAL
		</selectKey>
	INSERT INTO POST
	(
	POST_NO 		   
	,HOMPI_ID         
	,LPOST_GU         
	,MEM_ID           
	,POST_TITLE       
	,POST_CONTENT     
	,POST_DATE        
	,POST_VIEW 
	,ATCH_FILE_ID       
	)
	VALUES
	(
	'P'||#postNo#
	,#hompiId#
	,#lpostGu#
	,#memId#
	,#postTitle#
	,#postContent#
	,SYSDATE
	,0
	,#atchFileId#
	)                   
	</insert>
	
	<update id="updatePost" parameterClass="kr.or.ddit.post.vo.PostVO">
		UPDATE POST
         SET 
         POST_DATE = SYSDATE
          <isNotEmpty property="postTitle">
          ,POST_TITLE = #postTitle#
          </isNotEmpty>
          <isNotEmpty property="postContent">
          ,POST_Content = #postContent#
          </isNotEmpty>
<!--           <isNotEmpty property="atchFileId"> -->
<!--           ,ATCH_FILE_ID = #atchFileId# -->
<!--           </isNotEmpty> -->
	 	WHERE post_NO = #postNo#
	</update>
	
	<delete id="deletePost" parameterClass="String">
		DELETE 
		FROM POST
		WHERE post_NO = #postNo#
	</delete>
	<select id="getPostAll" resultClass="kr.or.ddit.post.vo.PostVO">
		SELECT 
			AA.POST_NO 		   postNo
			,AA.HOMPI_ID         	hompiId
			,AA.LPOST_GU         	lpostGu
			,AA.MEM_ID           	memId
			,AA.POST_TITLE       	postTitle
			,AA.POST_CONTENT     	postContent
			,AA.POST_DATE        	postDate
			,AA.POST_VIEW        	postView
			,AA.ATCH_FILE_ID 		atchFileId
 		FROM
 		(SELECT A.*, ROWNUM AS RNUM
 		 FROM POST A
 		) AA
 		WHERE AA.RNUM BETWEEN #firstRecNo# AND #lastRecNo#
 		ORDER BY AA.POST_NO DESC
	</select>
	
	<select id="getPostAllCount" resultClass="int">
	 		SELECT COUNT(*)
	 		FROM POST
	 </select>
	
	<select id="getSearchPost" parameterClass="kr.or.ddit.post.vo.PostVO" resultClass="kr.or.ddit.post.vo.PostVO">
	
	SELECT
		P.POST_NO 		   postNo
		,P.HOMPI_ID         	hompiId
		,P.LPOST_GU         	lpostGu
		,P.MEM_ID           	memId
		,P.POST_TITLE       	postTitle
		,P.POST_CONTENT     	postContent
		,P.POST_DATE        	postDate
		,P.POST_VIEW        	postView
		,P.ATCH_FILE_ID 		atchFileId
        ,M.MEM_NICKNAME         memNickname
	FROM POST P
    INNER JOIN MEMBER M
    ON P.MEM_ID = M.MEM_ID
    WHERE 1 = 1
    
    
	<isNotEmpty property="postNo">
           AND POST_NO = #postNo#
	 </isNotEmpty>
	 <isNotEmpty property="postTitle">
           AND POST_TITLE LIKE '%'||#postTitle#||'%'
	 </isNotEmpty>
	 <isNotEmpty property="postContent">
           AND POST_CONTENT LIKE '%'||#postContent#||'%'
	 </isNotEmpty>
	 <isNotEmpty property="memId">
           AND MEM_ID LIKE '%'||#memId#||'%'
	 </isNotEmpty>
	 ORDER BY POST_NO DESC

<!-- 	 SELECT -->
<!-- 		POST_NO 		   postNo -->
<!-- 		,HOMPI_ID         	hompiId -->
<!-- 		,LPOST_GU         	lpostGu -->
<!-- 		,MEM_ID           	memId -->
<!-- 		,POST_TITLE       	postTitle -->
<!-- 		,POST_CONTENT     	postContent -->
<!-- 		,POST_ATTACHMENTS 	postAttachments -->
<!-- 		,POST_DATE        	postDate -->
<!-- 		,POST_VIEW        	postView -->
<!-- 		 FROM post -->
<!-- 	 where 1=1 -->
<!-- 	 <isNotEmpty property="postNo"> -->
<!--            AND POST_NO = #postNo# -->
<!-- 	 </isNotEmpty> -->
<!-- 	 <isNotEmpty property="postTitle"> -->
<!--            AND post_TITLE = #postTitle# -->
<!-- 	 </isNotEmpty> -->
	</select>
	
	
<update id="updatePostView" parameterClass="kr.or.ddit.post.vo.PostVO">
		UPDATE POST
         SET 
         POST_VIEW = POST_VIEW+1
         WHERE POST_NO = #postNo#
</update>
	
	
	
</sqlMap>	



